{"ast":null,"code":"import { ethers } from 'ethers';\nimport { Base64 } from 'js-base64';\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\n\nvar __assign = function () {\n  __assign = Object.assign || function __assign(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nfunction __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nfunction __generator(thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n}\n\nvar encodeTypedDataHash = function (typedData) {\n  return ethers.utils._TypedDataEncoder.hash(typedData.domain, typedData.types, typedData.message);\n};\n\nvar encodeTypedDataDigest = function (typedData) {\n  var hash = encodeTypedDataHash(typedData);\n  var digest = ethers.utils.arrayify(ethers.utils.keccak256(hash));\n  return digest;\n};\n\nvar Proof =\n/** @class */\nfunction () {\n  function Proof(args) {\n    this.prefix = ETHAuthPrefix;\n    this.address = (args === null || args === void 0 ? void 0 : args.address) ? args.address.toLowerCase() : '';\n    this.claims = (args === null || args === void 0 ? void 0 : args.claims) ? args.claims : {\n      app: '',\n      iat: 0,\n      exp: 0,\n      v: ETHAuthVersion\n    };\n    this.signature = (args === null || args === void 0 ? void 0 : args.signature) ? args.signature : '';\n    this.extra = (args === null || args === void 0 ? void 0 : args.extra) ? args.extra : '';\n  }\n\n  Proof.prototype.setIssuedAtNow = function () {\n    this.claims.iat = Math.round(new Date().getTime() / 1000);\n  };\n\n  Proof.prototype.setExpiryIn = function (seconds) {\n    this.claims.exp = Math.round(new Date().getTime() / 1000) + seconds;\n  };\n\n  Proof.prototype.validateClaims = function () {\n    return validateClaims(this.claims);\n  };\n\n  Proof.prototype.messageDigest = function () {\n    var isValid = this.validateClaims();\n\n    if (isValid.err) {\n      throw isValid.err;\n    }\n\n    return ethers.utils.arrayify(encodeTypedDataHash(this.messageTypedData()));\n  };\n\n  Proof.prototype.messageTypedData = function () {\n    var domain = __assign({}, ETHAuthEIP712Domain);\n\n    var types = {\n      'Claims': []\n    };\n    var message = {};\n    var typedData = {\n      domain: domain,\n      types: types,\n      message: message\n    };\n\n    if (this.claims.app && this.claims.app.length > 0) {\n      typedData.types.Claims.push({\n        name: 'app',\n        type: 'string'\n      });\n      typedData.message['app'] = this.claims.app;\n    }\n\n    if (this.claims.iat && this.claims.iat > 0) {\n      typedData.types.Claims.push({\n        name: 'iat',\n        type: 'int64'\n      });\n      typedData.message['iat'] = this.claims.iat;\n    }\n\n    if (this.claims.exp && this.claims.exp > 0) {\n      typedData.types.Claims.push({\n        name: 'exp',\n        type: 'int64'\n      });\n      typedData.message['exp'] = this.claims.exp;\n    }\n\n    if (this.claims.n && this.claims.n > 0) {\n      typedData.types.Claims.push({\n        name: 'n',\n        type: 'uint64'\n      });\n      typedData.message['n'] = this.claims.n;\n    }\n\n    if (this.claims.typ && this.claims.typ.length > 0) {\n      typedData.types.Claims.push({\n        name: 'typ',\n        type: 'string'\n      });\n      typedData.message['typ'] = this.claims.typ;\n    }\n\n    if (this.claims.ogn && this.claims.ogn.length > 0) {\n      typedData.types.Claims.push({\n        name: 'ogn',\n        type: 'string'\n      });\n      typedData.message['ogn'] = this.claims.ogn;\n    }\n\n    if (this.claims.v && this.claims.v.length > 0) {\n      typedData.types.Claims.push({\n        name: 'v',\n        type: 'string'\n      });\n      typedData.message['v'] = this.claims.v;\n    }\n\n    return typedData;\n  };\n\n  return Proof;\n}();\n\nvar validateClaims = function (claims) {\n  if (claims.app === '') {\n    return {\n      ok: false,\n      err: new Error('claims: app is empty')\n    };\n  }\n\n  var now = Math.round(new Date().getTime() / 1000);\n  var drift = 5 * 60; // 5 minutes\n\n  var max = 60 * 60 * 24 * 365 + drift; // 1 year\n\n  if (claims.v === '') {\n    return {\n      ok: false,\n      err: new Error('claims: ethauth version is empty')\n    };\n  }\n\n  if (claims.iat && claims.iat !== 0 && (claims.iat > now + drift || claims.iat < now - max)) {\n    return {\n      ok: false,\n      err: new Error('claims: iat is invalid')\n    };\n  }\n\n  if (claims.exp < now - drift || claims.exp > now + max) {\n    return {\n      ok: false,\n      err: new Error('claims: token has expired')\n    };\n  }\n\n  return {\n    ok: true\n  };\n}; // ValidateEOAProof verifies the account proof, testing if the proof claims have been signed with an\n// EOA (externally owned account) and will return success/failture, the account address as a string, and any errors.\n\n\nvar ValidateEOAProof = function (provider, chainId, proof) {\n  return __awaiter(void 0, void 0, void 0, function () {\n    var messageDigest, address;\n    return __generator(this, function (_a) {\n      messageDigest = proof.messageDigest();\n      address = ethers.utils.verifyMessage(messageDigest, proof.signature);\n\n      if (address.slice(0, 2) === '0x' && address.length === 42 && address.toLowerCase() === proof.address.toLowerCase()) {\n        return [2\n        /*return*/\n        , {\n          isValid: true,\n          address: proof.address\n        }];\n      } else {\n        return [2\n        /*return*/\n        , {\n          isValid: false\n        }];\n      }\n    });\n  });\n}; // ValidateContractAccountProof verifies the account proof, testing if the\n// proof claims have been signed with a smart-contract based account by calling the EIP-1271\n// method of the remote contract. This method will return success/failure, the\n// account address as a string, and any errors. The wallet contract must be deployed in\n// order for this call to be successful. In order test an undeployed smart-wallet, you\n// will have to implement your own custom validator method.\n\n\nvar ValidateContractAccountProof = function (provider, chainId, proof) {\n  return __awaiter(void 0, void 0, void 0, function () {\n    var messageDigest, walletCode, abi, contract, isValidSignature;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          if (!provider || provider === undefined) {\n            return [2\n            /*return*/\n            , {\n              isValid: false\n            }];\n          }\n\n          messageDigest = proof.messageDigest();\n          return [4\n          /*yield*/\n          , provider.getCode(proof.address)];\n\n        case 1:\n          walletCode = _a.sent();\n\n          if (walletCode === '0x' || walletCode.length <= 2) {\n            throw new Error('ValidateContractAccountProof failed. unable to fetch wallet contract code');\n          }\n\n          abi = ['function isValidSignature(bytes32, bytes) public view returns (bytes4)'];\n          contract = new ethers.Contract(proof.address, abi, provider);\n          return [4\n          /*yield*/\n          , contract.isValidSignature(messageDigest, ethers.utils.arrayify(proof.signature))];\n\n        case 2:\n          isValidSignature = _a.sent();\n\n          if (isValidSignature === IsValidSignatureBytes32MagicValue) {\n            return [2\n            /*return*/\n            , {\n              isValid: true,\n              address: proof.address\n            }];\n          } else {\n            return [2\n            /*return*/\n            , {\n              isValid: false\n            }];\n          }\n\n      }\n    });\n  });\n}; // IsValidSignatureBytes32 is the EIP-1271 magic value we test\n\n\nvar IsValidSignatureBytes32MagicValue = '0x1626ba7e';\nvar ETHAuthVersion = '1';\nvar ETHAuthPrefix = 'eth';\nvar ETHAuthEIP712Domain = {\n  name: 'ETHAuth',\n  version: ETHAuthVersion\n};\n\nvar ETHAuth =\n/** @class */\nfunction () {\n  function ETHAuth() {\n    var _this = this;\n\n    var validators = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      validators[_i] = arguments[_i];\n    }\n\n    this.configJsonRpcProvider = function (ethereumJsonRpcURL) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var netVersion;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              this.provider = new ethers.providers.JsonRpcProvider(ethereumJsonRpcURL);\n              return [4\n              /*yield*/\n              , this.provider.send('net_version', [])];\n\n            case 1:\n              netVersion = _a.sent();\n              this.chainId = parseInt(netVersion);\n\n              if (!this.chainId || this.chainId === 0 || this.chainId === NaN) {\n                throw new Error('ethauth: unable to get chainId');\n              }\n\n              this.ethereumJsonRpcURL = ethereumJsonRpcURL;\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    this.configValidators = function () {\n      var validators = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        validators[_i] = arguments[_i];\n      }\n\n      if (validators.length == 0) {\n        throw new Error('validators list is empty');\n      }\n\n      _this.validators = validators;\n    };\n\n    this.encodeProof = function (proof, skipSignatureValidation) {\n      if (skipSignatureValidation === void 0) {\n        skipSignatureValidation = false;\n      }\n\n      return __awaiter(_this, void 0, void 0, function () {\n        var isValid, claimsJSON, proofString;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (proof.address.length !== 42 || proof.address.slice(0, 2) !== '0x') {\n                throw new Error('ethauth: invalid address');\n              }\n\n              if (proof.signature === '' || proof.signature.slice(0, 2) !== '0x') {\n                throw new Error('ethauth: invalid signature');\n              }\n\n              if (proof.extra && proof.extra.slice(0, 2) !== '0x') {\n                throw new Error('ethauth: invalid extra encoding, expecting hex data');\n              }\n\n              return [4\n              /*yield*/\n              , this.validateProof(proof, skipSignatureValidation)];\n\n            case 1:\n              isValid = _a.sent();\n\n              if (!isValid) {\n                throw new Error(\"ethauth: proof is invalid\");\n              }\n\n              claimsJSON = JSON.stringify(proof.claims);\n              proofString = ETHAuthPrefix + '.' + proof.address.toLowerCase() + '.' + Base64.encode(claimsJSON, true) + '.' + proof.signature;\n\n              if (proof.extra && proof.extra.length > 0) {\n                proofString += '.' + proof.extra;\n              }\n\n              return [2\n              /*return*/\n              , proofString];\n          }\n        });\n      });\n    };\n\n    this.decodeProof = function (proofString, skipSignatureValidation) {\n      if (skipSignatureValidation === void 0) {\n        skipSignatureValidation = false;\n      }\n\n      return __awaiter(_this, void 0, void 0, function () {\n        var parts, prefix, address, messageBase64, signature, extra, message, claims, proof, isValid;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              parts = proofString.split('.');\n\n              if (parts.length < 4 || parts.length > 5) {\n                throw new Error('ethauth: invalid proof string');\n              }\n\n              prefix = parts[0], address = parts[1], messageBase64 = parts[2], signature = parts[3], extra = parts[4]; // check prefix\n\n              if (prefix !== ETHAuthPrefix) {\n                throw new Error('ethauth: not an ethauth proof');\n              }\n\n              message = Base64.decode(messageBase64);\n              claims = JSON.parse(message);\n              proof = new Proof({\n                address: address,\n                claims: claims,\n                signature: signature,\n                extra: extra\n              });\n              return [4\n              /*yield*/\n              , this.validateProof(proof, skipSignatureValidation)];\n\n            case 1:\n              isValid = _a.sent();\n\n              if (!isValid) {\n                throw new Error(\"ethauth: proof is invalid\");\n              }\n\n              return [2\n              /*return*/\n              , proof];\n          }\n        });\n      });\n    };\n\n    this.validateProof = function (proof, skipSignatureValidation) {\n      if (skipSignatureValidation === void 0) {\n        skipSignatureValidation = false;\n      }\n\n      return __awaiter(_this, void 0, void 0, function () {\n        var isValidClaims, isValidSig;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              isValidClaims = this.validateProofClaims(proof);\n\n              if (isValidClaims.err) {\n                throw new Error(\"ethauth: proof claims are invalid \".concat(isValidClaims.err));\n              }\n\n              if (!(skipSignatureValidation !== true)) return [3\n              /*break*/\n              , 2];\n              return [4\n              /*yield*/\n              , this.validateProofSignature(proof)];\n\n            case 1:\n              isValidSig = _a.sent();\n\n              if (isValidSig !== true) {\n                throw new Error('ethauth: proof signature is invalid');\n              }\n\n              _a.label = 2;\n\n            case 2:\n              return [2\n              /*return*/\n              , true];\n          }\n        });\n      });\n    };\n\n    this.validateProofSignature = function (proof) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var retIsValid, i, validator, isValid, i;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              retIsValid = [];\n              i = 0;\n              _a.label = 1;\n\n            case 1:\n              if (!(i < this.validators.length)) return [3\n              /*break*/\n              , 6];\n              _a.label = 2;\n\n            case 2:\n              _a.trys.push([2, 4,, 5]);\n\n              validator = this.validators[i];\n              return [4\n              /*yield*/\n              , validator(this.provider, this.chainId, proof)];\n\n            case 3:\n              isValid = _a.sent().isValid;\n\n              if (isValid === true) {\n                // preemptively return true if we've determined it to be valid\n                return [2\n                /*return*/\n                , true];\n              }\n\n              retIsValid.push(isValid);\n              return [3\n              /*break*/\n              , 5];\n\n            case 4:\n              _a.sent();\n\n              retIsValid.push(false);\n              return [3\n              /*break*/\n              , 5];\n\n            case 5:\n              i++;\n              return [3\n              /*break*/\n              , 1];\n\n            case 6:\n              for (i = 0; i < retIsValid.length; i++) {\n                if (retIsValid[i]) {\n                  return [2\n                  /*return*/\n                  , true];\n                }\n              }\n\n              return [2\n              /*return*/\n              , false];\n          }\n        });\n      });\n    };\n\n    this.validateProofClaims = function (proof) {\n      return proof.validateClaims();\n    };\n\n    if (validators.length == 0) {\n      this.validators = [ValidateEOAProof, ValidateContractAccountProof];\n    } else {\n      this.validators = validators;\n    }\n  }\n\n  return ETHAuth;\n}();\n\nexport { ETHAuth, ETHAuthEIP712Domain, ETHAuthPrefix, ETHAuthVersion, IsValidSignatureBytes32MagicValue, Proof, ValidateContractAccountProof, ValidateEOAProof, encodeTypedDataDigest, encodeTypedDataHash, validateClaims };","map":{"version":3,"names":["ethers","Base64","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","__generator","body","_","label","sent","trys","ops","f","y","g","verb","Symbol","iterator","v","op","TypeError","pop","push","encodeTypedDataHash","typedData","utils","_TypedDataEncoder","hash","domain","types","message","encodeTypedDataDigest","digest","arrayify","keccak256","Proof","args","prefix","ETHAuthPrefix","address","toLowerCase","claims","app","iat","exp","ETHAuthVersion","signature","extra","setIssuedAtNow","Math","round","Date","getTime","setExpiryIn","seconds","validateClaims","messageDigest","isValid","err","messageTypedData","ETHAuthEIP712Domain","Claims","name","type","typ","ogn","ok","Error","now","drift","max","ValidateEOAProof","provider","chainId","proof","_a","verifyMessage","slice","ValidateContractAccountProof","walletCode","abi","contract","isValidSignature","undefined","getCode","Contract","IsValidSignatureBytes32MagicValue","version","ETHAuth","_this","validators","_i","configJsonRpcProvider","ethereumJsonRpcURL","netVersion","providers","JsonRpcProvider","send","parseInt","NaN","configValidators","encodeProof","skipSignatureValidation","claimsJSON","proofString","validateProof","JSON","stringify","encode","decodeProof","parts","messageBase64","split","decode","parse","isValidClaims","isValidSig","validateProofClaims","concat","validateProofSignature","retIsValid","validator"],"sources":["C:/Users/rishi/contract-poc/ThriEstate/Brandvilla/node_modules/@0xsequence/ethauth/dist/index.es.js"],"sourcesContent":["import { ethers } from 'ethers';\nimport { Base64 } from 'js-base64';\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\n\nvar encodeTypedDataHash = function (typedData) {\r\n    return ethers.utils._TypedDataEncoder.hash(typedData.domain, typedData.types, typedData.message);\r\n};\r\nvar encodeTypedDataDigest = function (typedData) {\r\n    var hash = encodeTypedDataHash(typedData);\r\n    var digest = ethers.utils.arrayify(ethers.utils.keccak256(hash));\r\n    return digest;\r\n};\n\nvar Proof = /** @class */ (function () {\r\n    function Proof(args) {\r\n        this.prefix = ETHAuthPrefix;\r\n        this.address = (args === null || args === void 0 ? void 0 : args.address) ? args.address.toLowerCase() : '';\r\n        this.claims = (args === null || args === void 0 ? void 0 : args.claims) ? args.claims : { app: '', iat: 0, exp: 0, v: ETHAuthVersion };\r\n        this.signature = (args === null || args === void 0 ? void 0 : args.signature) ? args.signature : '';\r\n        this.extra = (args === null || args === void 0 ? void 0 : args.extra) ? args.extra : '';\r\n    }\r\n    Proof.prototype.setIssuedAtNow = function () {\r\n        this.claims.iat = Math.round((new Date()).getTime() / 1000);\r\n    };\r\n    Proof.prototype.setExpiryIn = function (seconds) {\r\n        this.claims.exp = Math.round((new Date()).getTime() / 1000) + seconds;\r\n    };\r\n    Proof.prototype.validateClaims = function () {\r\n        return validateClaims(this.claims);\r\n    };\r\n    Proof.prototype.messageDigest = function () {\r\n        var isValid = this.validateClaims();\r\n        if (isValid.err) {\r\n            throw isValid.err;\r\n        }\r\n        return ethers.utils.arrayify(encodeTypedDataHash(this.messageTypedData()));\r\n    };\r\n    Proof.prototype.messageTypedData = function () {\r\n        var domain = __assign({}, ETHAuthEIP712Domain);\r\n        var types = {\r\n            'Claims': []\r\n        };\r\n        var message = {};\r\n        var typedData = { domain: domain, types: types, message: message };\r\n        if (this.claims.app && this.claims.app.length > 0) {\r\n            typedData.types.Claims.push({ name: 'app', type: 'string' });\r\n            typedData.message['app'] = this.claims.app;\r\n        }\r\n        if (this.claims.iat && this.claims.iat > 0) {\r\n            typedData.types.Claims.push({ name: 'iat', type: 'int64' });\r\n            typedData.message['iat'] = this.claims.iat;\r\n        }\r\n        if (this.claims.exp && this.claims.exp > 0) {\r\n            typedData.types.Claims.push({ name: 'exp', type: 'int64' });\r\n            typedData.message['exp'] = this.claims.exp;\r\n        }\r\n        if (this.claims.n && this.claims.n > 0) {\r\n            typedData.types.Claims.push({ name: 'n', type: 'uint64' });\r\n            typedData.message['n'] = this.claims.n;\r\n        }\r\n        if (this.claims.typ && this.claims.typ.length > 0) {\r\n            typedData.types.Claims.push({ name: 'typ', type: 'string' });\r\n            typedData.message['typ'] = this.claims.typ;\r\n        }\r\n        if (this.claims.ogn && this.claims.ogn.length > 0) {\r\n            typedData.types.Claims.push({ name: 'ogn', type: 'string' });\r\n            typedData.message['ogn'] = this.claims.ogn;\r\n        }\r\n        if (this.claims.v && this.claims.v.length > 0) {\r\n            typedData.types.Claims.push({ name: 'v', type: 'string' });\r\n            typedData.message['v'] = this.claims.v;\r\n        }\r\n        return typedData;\r\n    };\r\n    return Proof;\r\n}());\r\nvar validateClaims = function (claims) {\r\n    if (claims.app === '') {\r\n        return { ok: false, err: new Error('claims: app is empty') };\r\n    }\r\n    var now = Math.round((new Date()).getTime() / 1000);\r\n    var drift = 5 * 60; // 5 minutes\r\n    var max = (60 * 60 * 24 * 365) + drift; // 1 year\r\n    if (claims.v === '') {\r\n        return { ok: false, err: new Error('claims: ethauth version is empty') };\r\n    }\r\n    if (claims.iat && claims.iat !== 0 && (claims.iat > now + drift || claims.iat < now - max)) {\r\n        return { ok: false, err: new Error('claims: iat is invalid') };\r\n    }\r\n    if (claims.exp < now - drift || claims.exp > now + max) {\r\n        return { ok: false, err: new Error('claims: token has expired') };\r\n    }\r\n    return { ok: true };\r\n};\n\n// ValidateEOAProof verifies the account proof, testing if the proof claims have been signed with an\r\n// EOA (externally owned account) and will return success/failture, the account address as a string, and any errors.\r\nvar ValidateEOAProof = function (provider, chainId, proof) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var messageDigest, address;\r\n    return __generator(this, function (_a) {\r\n        messageDigest = proof.messageDigest();\r\n        address = ethers.utils.verifyMessage(messageDigest, proof.signature);\r\n        if (address.slice(0, 2) === '0x' && address.length === 42 &&\r\n            address.toLowerCase() === proof.address.toLowerCase()) {\r\n            return [2 /*return*/, { isValid: true, address: proof.address }];\r\n        }\r\n        else {\r\n            return [2 /*return*/, { isValid: false }];\r\n        }\r\n    });\r\n}); };\r\n// ValidateContractAccountProof verifies the account proof, testing if the\r\n// proof claims have been signed with a smart-contract based account by calling the EIP-1271\r\n// method of the remote contract. This method will return success/failure, the\r\n// account address as a string, and any errors. The wallet contract must be deployed in\r\n// order for this call to be successful. In order test an undeployed smart-wallet, you\r\n// will have to implement your own custom validator method.\r\nvar ValidateContractAccountProof = function (provider, chainId, proof) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var messageDigest, walletCode, abi, contract, isValidSignature;\r\n    return __generator(this, function (_a) {\r\n        switch (_a.label) {\r\n            case 0:\r\n                if (!provider || provider === undefined) {\r\n                    return [2 /*return*/, { isValid: false }];\r\n                }\r\n                messageDigest = proof.messageDigest();\r\n                return [4 /*yield*/, provider.getCode(proof.address)];\r\n            case 1:\r\n                walletCode = _a.sent();\r\n                if (walletCode === '0x' || walletCode.length <= 2) {\r\n                    throw new Error('ValidateContractAccountProof failed. unable to fetch wallet contract code');\r\n                }\r\n                abi = ['function isValidSignature(bytes32, bytes) public view returns (bytes4)'];\r\n                contract = new ethers.Contract(proof.address, abi, provider);\r\n                return [4 /*yield*/, contract.isValidSignature(messageDigest, ethers.utils.arrayify(proof.signature))];\r\n            case 2:\r\n                isValidSignature = _a.sent();\r\n                if (isValidSignature === IsValidSignatureBytes32MagicValue) {\r\n                    return [2 /*return*/, { isValid: true, address: proof.address }];\r\n                }\r\n                else {\r\n                    return [2 /*return*/, { isValid: false }];\r\n                }\r\n        }\r\n    });\r\n}); };\r\n// IsValidSignatureBytes32 is the EIP-1271 magic value we test\r\nvar IsValidSignatureBytes32MagicValue = '0x1626ba7e';\n\nvar ETHAuthVersion = '1';\r\nvar ETHAuthPrefix = 'eth';\r\nvar ETHAuthEIP712Domain = {\r\n    name: 'ETHAuth',\r\n    version: ETHAuthVersion,\r\n};\r\nvar ETHAuth = /** @class */ (function () {\r\n    function ETHAuth() {\r\n        var _this = this;\r\n        var validators = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            validators[_i] = arguments[_i];\r\n        }\r\n        this.configJsonRpcProvider = function (ethereumJsonRpcURL) { return __awaiter(_this, void 0, void 0, function () {\r\n            var netVersion;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.provider = new ethers.providers.JsonRpcProvider(ethereumJsonRpcURL);\r\n                        return [4 /*yield*/, this.provider.send('net_version', [])];\r\n                    case 1:\r\n                        netVersion = _a.sent();\r\n                        this.chainId = parseInt(netVersion);\r\n                        if (!this.chainId || this.chainId === 0 || this.chainId === NaN) {\r\n                            throw new Error('ethauth: unable to get chainId');\r\n                        }\r\n                        this.ethereumJsonRpcURL = ethereumJsonRpcURL;\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        }); };\r\n        this.configValidators = function () {\r\n            var validators = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                validators[_i] = arguments[_i];\r\n            }\r\n            if (validators.length == 0) {\r\n                throw new Error('validators list is empty');\r\n            }\r\n            _this.validators = validators;\r\n        };\r\n        this.encodeProof = function (proof, skipSignatureValidation) {\r\n            if (skipSignatureValidation === void 0) { skipSignatureValidation = false; }\r\n            return __awaiter(_this, void 0, void 0, function () {\r\n                var isValid, claimsJSON, proofString;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            if (proof.address.length !== 42 || proof.address.slice(0, 2) !== '0x') {\r\n                                throw new Error('ethauth: invalid address');\r\n                            }\r\n                            if (proof.signature === '' || proof.signature.slice(0, 2) !== '0x') {\r\n                                throw new Error('ethauth: invalid signature');\r\n                            }\r\n                            if (proof.extra && proof.extra.slice(0, 2) !== '0x') {\r\n                                throw new Error('ethauth: invalid extra encoding, expecting hex data');\r\n                            }\r\n                            return [4 /*yield*/, this.validateProof(proof, skipSignatureValidation)];\r\n                        case 1:\r\n                            isValid = _a.sent();\r\n                            if (!isValid) {\r\n                                throw new Error(\"ethauth: proof is invalid\");\r\n                            }\r\n                            claimsJSON = JSON.stringify(proof.claims);\r\n                            proofString = ETHAuthPrefix + '.' +\r\n                                proof.address.toLowerCase() + '.' +\r\n                                Base64.encode(claimsJSON, true) + '.' +\r\n                                proof.signature;\r\n                            if (proof.extra && proof.extra.length > 0) {\r\n                                proofString += '.' + proof.extra;\r\n                            }\r\n                            return [2 /*return*/, proofString];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        this.decodeProof = function (proofString, skipSignatureValidation) {\r\n            if (skipSignatureValidation === void 0) { skipSignatureValidation = false; }\r\n            return __awaiter(_this, void 0, void 0, function () {\r\n                var parts, prefix, address, messageBase64, signature, extra, message, claims, proof, isValid;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            parts = proofString.split('.');\r\n                            if (parts.length < 4 || parts.length > 5) {\r\n                                throw new Error('ethauth: invalid proof string');\r\n                            }\r\n                            prefix = parts[0], address = parts[1], messageBase64 = parts[2], signature = parts[3], extra = parts[4];\r\n                            // check prefix\r\n                            if (prefix !== ETHAuthPrefix) {\r\n                                throw new Error('ethauth: not an ethauth proof');\r\n                            }\r\n                            message = Base64.decode(messageBase64);\r\n                            claims = JSON.parse(message);\r\n                            proof = new Proof({ address: address, claims: claims, signature: signature, extra: extra });\r\n                            return [4 /*yield*/, this.validateProof(proof, skipSignatureValidation)];\r\n                        case 1:\r\n                            isValid = _a.sent();\r\n                            if (!isValid) {\r\n                                throw new Error(\"ethauth: proof is invalid\");\r\n                            }\r\n                            return [2 /*return*/, proof];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        this.validateProof = function (proof, skipSignatureValidation) {\r\n            if (skipSignatureValidation === void 0) { skipSignatureValidation = false; }\r\n            return __awaiter(_this, void 0, void 0, function () {\r\n                var isValidClaims, isValidSig;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            isValidClaims = this.validateProofClaims(proof);\r\n                            if (isValidClaims.err) {\r\n                                throw new Error(\"ethauth: proof claims are invalid \".concat(isValidClaims.err));\r\n                            }\r\n                            if (!(skipSignatureValidation !== true)) return [3 /*break*/, 2];\r\n                            return [4 /*yield*/, this.validateProofSignature(proof)];\r\n                        case 1:\r\n                            isValidSig = _a.sent();\r\n                            if (isValidSig !== true) {\r\n                                throw new Error('ethauth: proof signature is invalid');\r\n                            }\r\n                            _a.label = 2;\r\n                        case 2: return [2 /*return*/, true];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        this.validateProofSignature = function (proof) { return __awaiter(_this, void 0, void 0, function () {\r\n            var retIsValid, i, validator, isValid, i;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        retIsValid = [];\r\n                        i = 0;\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        if (!(i < this.validators.length)) return [3 /*break*/, 6];\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 4, , 5]);\r\n                        validator = this.validators[i];\r\n                        return [4 /*yield*/, validator(this.provider, this.chainId, proof)];\r\n                    case 3:\r\n                        isValid = (_a.sent()).isValid;\r\n                        if (isValid === true) {\r\n                            // preemptively return true if we've determined it to be valid\r\n                            return [2 /*return*/, true];\r\n                        }\r\n                        retIsValid.push(isValid);\r\n                        return [3 /*break*/, 5];\r\n                    case 4:\r\n                        _a.sent();\r\n                        retIsValid.push(false);\r\n                        return [3 /*break*/, 5];\r\n                    case 5:\r\n                        i++;\r\n                        return [3 /*break*/, 1];\r\n                    case 6:\r\n                        for (i = 0; i < retIsValid.length; i++) {\r\n                            if (retIsValid[i]) {\r\n                                return [2 /*return*/, true];\r\n                            }\r\n                        }\r\n                        return [2 /*return*/, false];\r\n                }\r\n            });\r\n        }); };\r\n        this.validateProofClaims = function (proof) {\r\n            return proof.validateClaims();\r\n        };\r\n        if (validators.length == 0) {\r\n            this.validators = [ValidateEOAProof, ValidateContractAccountProof];\r\n        }\r\n        else {\r\n            this.validators = validators;\r\n        }\r\n    }\r\n    return ETHAuth;\r\n}());\n\nexport { ETHAuth, ETHAuthEIP712Domain, ETHAuthPrefix, ETHAuthVersion, IsValidSignatureBytes32MagicValue, Proof, ValidateContractAccountProof, ValidateEOAProof, encodeTypedDataDigest, encodeTypedDataHash, validateClaims };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}